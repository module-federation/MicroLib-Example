{"version":3,"sources":["webpack://microlib-example/./src/lib/utils.js","webpack://microlib-example/./src/services/address-service.js","webpack://microlib-example/./src/services/event-service.js","webpack://microlib-example/./src/services/index.js","webpack://microlib-example/./src/services/inventory-service.js","webpack://microlib-example/./src/services/payment-service.js","webpack://microlib-example/./src/services/publish-event.js","webpack://microlib-example/./src/services/shipping-service.js"],"names":["compose","funcs","initVal","reduceRight","val","func","composeAsync","then","Promise","resolve","passwd","process","env","ENCRYPTION_PWD","algo","key","crypto","iv","Buffer","alloc","encrypt","text","cipher","encrypted","update","decrypt","cipherText","console","log","decipher","decrypted","hash","data","digest","uuid","replace","c","toString","makeArray","v","Array","isArray","makeObject","prop","reduce","p","async","promise","result","ok","object","asObject","asArray","error","require","SmartyStreetsSDK","SmartyStreetsCore","core","Lookup","usStreet","disabled","SMARTY_DISABLED","authId","SMARTY_AUTH_ID","authToken","SMARTY_AUTH_TOKEN","credentials","StaticCredentials","client","buildClient","Address","validateAddress","address","lookup","inputId","street","maxCandidates","send","response","Error","candidate","lookups","validatedAddress","deliveryLine1","deliveryLine2","lastLine","join","brokers","KAFKA_BROKERS","topics","RegExp","KAFKA_TOPICS","groupId","KAFKA_GROUP_ID","pid","kafka","Kafka","clientId","split","consumer","producer","Event","listening","listen","topic","callback","connect","subscribe","fromBeginning","run","eachMessage","message","value","notify","messages","disconnect","name","Payment","authorizePayment","id","amount","source_id","customer_id","autocomplete","currency","payload","idempotency_key","amount_money","location_id","reference_id","note","app_fee_money","completePayment","model","orderNo","refundPayment","publishEvent","event","serialized","JSON","stringify","options","hostname","port","path","method","headers","byteLength","req","http","res","setEncoding","on","chunk","e","write","end","createEventMessage","requester","service","type","eventSource","eventTarget","eventType","eventName","eventTime","Date","getTime","eventUuid","eventData","createCommandEvent","args","commandName","commandResp","commandArgs","Shipping","serviceName","shipOrder","shipTo","shipFrom","lineItems","signature","externalId","respondOn","trackShipment","shipmentId","trackingId","verifyDelivery","returnShipment","getPayload","payloads","trackingStatus","proofOfDelivery","getProperty"],"mappings":"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","file":"src_services_index_js.js","sourcesContent":["\"use strict\";\n\nimport crypto from \"crypto\";\n\nexport function compose(...funcs) {\n  return function (initVal) {\n    return funcs.reduceRight((val, func) => func(val), initVal);\n  };\n}\n\nexport function composeAsync(...funcs) {\n  return function (initVal) {\n    return funcs.reduceRight(\n      (val, func) => val.then(func),\n      Promise.resolve(initVal)\n    );\n  };\n}\n\nconst passwd = process.env.ENCRYPTION_PWD;\nconst algo = \"aes-192-cbc\";\nconst key = crypto.scryptSync(passwd, \"salt\", 24);\nconst iv = Buffer.alloc(16, 0);\n\nexport function encrypt(text) {\n  const cipher = crypto.createCipheriv(algo, key, iv);\n  let encrypted = cipher.update(text, \"utf8\", \"hex\");\n  encrypted += cipher.final(\"hex\");\n  return encrypted;\n}\n\nexport function decrypt(cipherText) {\n  console.log(\"decrypt(%s)\", cipherText);\n  const decipher = crypto.createDecipheriv(algo, key, iv);\n  let decrypted = decipher.update(cipherText, \"hex\", \"utf8\");\n  decrypted += decipher.final(\"utf8\");\n  return decrypted;\n}\n\nexport function hash(data) {\n  return crypto.createHash(\"sha1\").update(data).digest(\"hex\");\n}\n\nexport function uuid() {\n  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n    (c ^ (crypto.randomBytes(16)[0] & (15 >> (c / 4)))).toString(16)\n  );\n}\n\nexport function makeArray(v) {\n  return Array.isArray(v) ? v : [v];\n}\n\nexport function makeObject(prop) {\n  if (Array.isArray(prop)) {\n    return prop.reduce((p, c) => ({ ...p, ...c }));\n  }\n  return prop;\n}\n\n/**\n *\n * @param {Promise<{\n * ok:()=>any,\n *\n * }} promise\n * @returns\n */\nexport function async(promise) {\n  return promise\n    .then(result => ({\n      ok: true,\n      object: result,\n      asObject: () => makeObject(result),\n      asArray: () => makeArray(result),\n    }))\n    .catch(error => {\n      console.error(error);\n      return Promise.resolve({ ok: false, error });\n    });\n}\n","\"use strict\";\n\nconst uuid = require(\"../lib/utils\").uuid;\nconst SmartyStreetsSDK = require(\"smartystreets-javascript-sdk\");\n\nconst SmartyStreetsCore = SmartyStreetsSDK.core;\nconst Lookup = SmartyStreetsSDK.usStreet.Lookup;\n\n// for Server-to-server requests, use this code:\nconst disabled = process.env.SMARTY_DISABLED || false;\nconst authId = process.env.SMARTY_AUTH_ID;\nconst authToken = process.env.SMARTY_AUTH_TOKEN;\nconst credentials = new SmartyStreetsCore.StaticCredentials(authId, authToken);\n\nconst client = SmartyStreetsCore.buildClient.usStreet(credentials);\n\n/**\n * @typedef {{function(address):Promise<string>}} Address\n */\nexport const Address = {\n  // Documentation for input fields can be found at:\n  // https://smartystreets.com/docs/us-street-api#input-fields\n\n  async validateAddress(address) {\n    console.log(`REAL validating address...${address}`);\n\n    if (!address) {\n      console.log(\"no address\");\n      return;\n    }\n\n    if (disabled) {\n      console.log(\"address service disabled\");\n      return address;\n    }\n\n    let lookup = new Lookup();\n    lookup.inputId = uuid();\n    lookup.street = address;\n    lookup.maxCandidates = 1;\n\n    let response;\n    try {\n      response = await client.send(lookup);\n    } catch (error) {\n      throw new Error(error);\n    }\n\n    const candidate = response.lookups[0].result[0];\n    if (!candidate) {\n      throw new Error(\"invalid address\");\n    }\n\n    const validatedAddress = [\n      candidate.deliveryLine1,\n      candidate.deliveryLine2,\n      candidate.lastLine,\n    ].join(\" \");\n\n    console.log(`address: ${validatedAddress}`);\n\n    if (!validatedAddress) {\n      throw new Error(\"invalid address\");\n    }\n    return validatedAddress;\n  },\n};\n","\"use strict\";\n\nimport { Kafka } from \"kafkajs\";\n\nconst brokers = process.env.KAFKA_BROKERS || \"localhost:9092\";\nconst topics = new RegExp(process.env.KAFKA_TOPICS) || /Channel/;\nconst groupId = process.env.KAFKA_GROUP_ID || \"MicroLib\" + process.pid;\n\nconst kafka = new Kafka({\n  clientId: \"MicroLib\",\n  brokers: brokers.split(\",\"),\n});\n\nconst consumer = kafka.consumer({ groupId });\nconst producer = kafka.producer();\n\n/**\n * @typedef {EventService}\n */\nexport const Event = {\n  listening: false,\n  topics,\n\n  /**\n   * Implements event consumer service.\n   * @param {string|RegExp} topic\n   * @param {function({message, topic})} callback\n   */\n  async listen(topic, callback) {\n    try {\n      await consumer.connect();\n      await consumer.subscribe({ topic, fromBeginning: true });\n      this.listening = true;\n      await consumer.run({\n        eachMessage: async ({ topic, message }) => {\n          try {\n            callback({\n              topic,\n              message: message.value.toString(),\n            });\n          } catch (error) {\n            console.error(error);\n          }\n        },\n      });\n    } catch (error) {\n      console.error(error);\n    }\n  },\n\n  /**\n   * Implemements event producer service.\n   * @param {string|RegExp} topic\n   * @param {string} message\n   */\n  async notify(topic, message) {\n    try {\n      await producer.connect();\n      await producer.send({\n        topic: topic,\n        messages: [{ value: message }],\n      });\n      await producer.disconnect();\n    } catch (error) {\n      console.error({ func: this.notify.name, error });\n    }\n  },\n};\n","export * from \"./address-service\";\nexport * from \"./event-service\";\nexport * from \"./inventory-service\";\nexport * from \"./payment-service\";\nexport * from \"./shipping-service\";\nexport * from \"./publish-event\";\n","\"use strict\";\n\n// JSON.stringify({\n//     eventType: \"Command\",\n//     eventTime: new Date().toUTCString(),\n//     eventSource: \"orderService\",\n//     eventData: {\n//       replyChannel: \"orderChannel\",\n//       commandName: \"pickOrder\",\n//       commandArgs: {\n//       }\n","\"use strict\";\n\n/**\n * @callback authorizePaymentType\n * @param {string} id\n * @param {number} amount\n * @param {string} source_id\n * @param {string} customer_id\n * @param {boolean} [autocomplete]\n * @returns {Promise<string>}\n */\n\n/**\n * @typedef PaymentService\n * @property {authorizePaymentType} authorizePayment\n * @property {function()} completePayment\n * @property {function()} refundPayment\n */\n\n// import { Client, Environment, ApiError } from \"square\";\n\n// const client = new Client({\n//   environment: Environment.Sandbox,\n//   accessToken: process.env.SQUARE_ACCESS_TOKEN,\n// });\n\nexport const Payment = {\n  /**\n   * @type {authorizePaymentType}\n   * @param {*} id\n   * @param {*} amount\n   * @param {*} source_id\n   * @param {*} customer_id\n   * @param {*} autocomplete\n   * @param {*} currency\n   */\n  async authorizePayment(\n    id,\n    amount,\n    source_id,\n    customer_id,\n    autocomplete = false,\n    currency = \"USD\"\n  ) {\n    const payload = {\n      idempotency_key: id,\n      amount_money: {\n        amount,\n        currency,\n      },\n      source_id,\n      autocomplete,\n      customer_id,\n      location_id: \"XK3DBG77NJBFX\",\n      reference_id: \"123456\",\n      note: \"Brief description\",\n      app_fee_money: {\n        amount: 10,\n        currency: \"USD\",\n      },\n    };\n    /*\n    const bodyAmountMoney = {};\n    bodyAmountMoney.amount = 200;\n    bodyAmountMoney.currency = \"USD\";\n\n    const bodyTipMoney = {};\n    bodyTipMoney.amount = 198;\n    bodyTipMoney.currency = \"CHF\";\n\n    const bodyAppFeeMoney = {};\n    bodyAppFeeMoney.amount = 10;\n    bodyAppFeeMoney.currency = \"USD\";\n\n    const body = {\n      sourceId: \"ccof:uIbfJXhXETSP197M3GB\",\n      idempotencyKey: \"4935a656-a929-4792-b97c-8848be85c27c\",\n      amountMoney: bodyAmountMoney,\n    };\n\n    body.tipMoney = bodyTipMoney;\n    body.appFeeMoney = bodyAppFeeMoney;\n    body.delayDuration = \"delay_duration6\";\n    body.autocomplete = true;\n    body.orderId = \"order_id0\";\n    body.customerId = \"VDKXEEKPJN48QDG3BGGFAK05P8\";\n    body.locationId = \"XK3DBG77NJBFX\";\n    body.referenceId = \"123456\";\n    body.note = \"Brief description\";\n\n    // try {\n    //   const {\n    //     result,\n    //     ...httpResponse\n    //   } = await client.paymentsApi.createPayment(body);\n    //   // Get more response info...\n    //   // const { statusCode, headers } = httpResponse;\n    // } catch (error) {\n    //   if (error instanceof ApiError) {\n    //     const errors = error.result;\n    //     // const { statusCode, headers } = error;\n    //   }\n    // }\n    */\n    return \"1234\";\n  },\n\n  /*\n  const response ={\n  \"payment\": {\n    \"id\": \"GQTFp1ZlXdpoW4o6eGiZhbjosiDFf\",\n    \"created_at\": \"2019-07-10T13:23:49.154Z\",\n    \"updated_at\": \"2019-07-10T13:23:49.446Z\",\n    \"amount_money\": {\n      \"amount\": 200,\n      \"currency\": \"USD\"\n    },\n    \"app_fee_money\": {\n      \"amount\": 10,\n      \"currency\": \"USD\"\n    },\n    \"total_money\": {\n      \"amount\": 200,\n      \"currency\": \"USD\"\n    },\n    \"status\": \"COMPLETED\",\n    \"source_type\": \"CARD\",\n    \"card_details\": {\n      \"status\": \"CAPTURED\",\n      \"card\": {\n        \"card_brand\": \"VISA\",\n        \"last_4\": \"1111\",\n        \"exp_month\": 7,\n        \"exp_year\": 2026,\n        \"fingerprint\": \"sq-1-TpmjbNBMFdibiIjpQI5LiRgNUBC7u1689i0TgHjnlyHEWYB7tnn-K4QbW4ttvtaqXw\",\n        \"card_type\": \"DEBIT\",\n        \"prepaid_type\": \"PREPAID\",\n        \"bin\": \"411111\"\n      },\n      \"entry_method\": \"ON_FILE\",\n      \"cvv_status\": \"CVV_ACCEPTED\",\n      \"avs_status\": \"AVS_ACCEPTED\",\n      \"auth_result_code\": \"nsAyY2\",\n      \"statement_description\": \"SQ *MY MERCHANT\"\n    },\n    \"location_id\": \"XTI0H92143A39\",\n    \"order_id\": \"m2Hr8Hk8A3CTyQQ1k4ynExg92tO3\",\n    \"reference_id\": \"123456\",\n    \"note\": \"Brief description\",\n    \"customer_id\": \"RDX9Z4XTIZR7MRZJUXNY9HUK6I\",\n    \"receipt_number\": \"GQTF\",\n    \"receipt_url\": \"https://squareup.com/receipt/preview/GQTFp1ZlXdpoW4o6eGiZhbjosiDFf\"\n  }\n}\n  /*\n{\n  \"errors\": [\n    {\n      \"code\": \"VALUE_EMPTY\",\n      \"detail\": \"Field must not be blank\",\n      \"field\": \"source_id\",\n      \"category\": \"INVALID_REQUEST_ERROR\"\n    },\n    {\n      \"code\": \"VALUE_EMPTY\",\n      \"detail\": \"Field must not be blank\",\n      \"field\": \"idempotency_key\",\n      \"category\": \"INVALID_REQUEST_ERROR\"\n    },\n    {\n      \"code\": \"MISSING_REQUIRED_PARAMETER\",\n      \"detail\": \"Field must be set\",\n      \"field\": \"amount_money\",\n      \"category\": \"INVALID_REQUEST_ERROR\"\n    }\n  ]\n}\n  */\n\n  async completePayment(model) {\n    console.log(\"REAL completing payment: %s\", model.orderNo);\n    return \"1234\";\n  },\n\n  async refundPayment(model) {\n    console.log(\"REAL refunding payment: %s\", model.orderNo);\n  },\n};\n","import http from \"http\";\n\nexport function publishEvent(event) {\n  if (!event) {\n    return;\n  }\n  const serialized = JSON.stringify(event);\n\n  const options = {\n    hostname: \"localhost\",\n    port: 8060,\n    path: \"/api/publish\",\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Content-Length\": Buffer.byteLength(serialized),\n    },\n  };\n\n  const req = http.request(options, res => {\n    res.setEncoding(\"utf8\");\n    res.on(\"data\", chunk => {\n      console.log(chunk);\n    });\n    res.on(\"end\", () => {});\n  });\n\n  req.on(\"error\", e => {\n    // console.error(`problem with request: ${e.message}`);\n  });\n\n  // Write data to request body\n  req.write(serialized);\n  req.end();\n}\n","\"use strict\";\n\n/**\n * @typedef {import('../adapters/event-adapter').EventMessage} EventMessage\n */\n\n/**\n * @typedef {import('../adapters/event-adapter').CommandEvent} CommandEvent\n */\n\n/**\n * @callback shipOrder\n * @param {string} shipTo\n * @param {string} shipFrom\n * @param {string} lineItems\n * @param {string} signature\n * @param {string} externalId\n * @param {string} requester\n * @param {string} respondOn\n * @returns {EventMessage}\n */\n\n/**\n * @callback trackShipment\n * @param {string} shipmentId\n * @param {string} externalId\n * @param {string} requester\n * @param {string} respondOn\n * @returns {EventMessage}\n */\n\n/**\n * @typedef {string} functionName\n */\n\n/**\n * @typedef {Object} shippingService formats and parses shipping event messages\n * @property {string} serviceName - programmatic service name in eventSource/Target\n * @property {string} topic - event topic \"shippingChannel\" when sending messasges\n * @property {shipOrder} shipOrder - format event message requesting shipping label and pickup of order\n * @property {trackShipment} trackShipment - report on location/status of parcel\n * @property {function():EventMessage} verifyDelivery - ensure customer recieved parcel\n * @property {function():EventMessage} returnShipment - return to sender if refunding\n * @property {function(functionName,EventMessage):{[key]:string}} getPayload - extract payload\n */\n\nfunction createEventMessage({ requester, service, type, name, id, data }) {\n  return {\n    eventSource: requester,\n    eventTarget: service,\n    eventType: type,\n    eventName: name,\n    eventTime: new Date().getTime(),\n    eventUuid: id,\n    eventData: data,\n  };\n}\n\nfunction createCommandEvent(name, topic, args) {\n  return {\n    commandName: name,\n    commandResp: topic,\n    commandArgs: { ...args },\n  };\n}\n\n/**\n * Shipping service events\n * @type {shippingService}\n */\nexport const Shipping = {\n  serviceName: \"shippingService\",\n  topic: \"shippingChannel\",\n\n  /**\n   *\n   * @param {*} param0\n   * @returns {shipMessage}\n   */\n  shipOrder({\n    shipTo,\n    shipFrom,\n    lineItems,\n    signature,\n    externalId,\n    requester,\n    respondOn,\n  }) {\n    return createEventMessage({\n      requester,\n      service: this.serviceName,\n      type: \"command\",\n      name: this.shipOrder.name,\n      id: externalId,\n      data: createCommandEvent(this.shipOrder.name, respondOn, {\n        shipTo,\n        shipFrom,\n        lineItems,\n        signature,\n        externalId,\n      }),\n    });\n  },\n\n  /**\n   *\n   * @param {*} param0\n   * @returns {EventMessage}\n   */\n  trackShipment({ externalId, shipmentId, trackingId, requester, respondOn }) {\n    return createEventMessage({\n      requester,\n      service: this.serviceName,\n      type: \"command\",\n      name: this.trackShipment.name,\n      id: externalId,\n      data: createCommandEvent(this.trackShipment.name, respondOn, {\n        externalId,\n        shipmentId,\n        trackingId,\n      }),\n    });\n  },\n\n  /**\n   *\n   * @param {*} param0\n   * @returns {EventMessage}\n   */\n  verifyDelivery({ requester, respondOn, trackingId, externalId }) {\n    return createEventMessage({\n      requester,\n      service: this.serviceName,\n      type: \"command\",\n      name: this.verifyDelivery.name,\n      id: externalId,\n      data: createCommandEvent(this.verifyDelivery.name, respondOn, {\n        externalId,\n        trackingId,\n      }),\n    });\n  },\n\n  returnShipment({ requester, respondOn, shipmentId, externalId }) {\n    return createEventMessage({\n      requester,\n      service: this.serviceName,\n      type: \"command\",\n      id: externalId,\n      name: this.returnShipment.name,\n      data: createCommandEvent(this.returnShipment, respondOn, {\n        shipmentId,\n        externalId,\n      }),\n    });\n  },\n\n  getPayload(func, event) {\n    const payloads = {\n      [this.shipOrder.name]: {\n        shipmentId: event.eventData.shipmentId,\n      },\n      [this.trackShipment.name]: {\n        trackingId: event.eventData.trackingId,\n        trackingStatus: event.eventData.trackingStatus,\n      },\n      [this.verifyDelivery.name]: {\n        proofOfDelivery: event.eventData.proofOfDelivery,\n      },\n    };\n    return payloads[func];\n  },\n\n  getProperty(event, key) {\n    return event.eventData[key];\n  },\n};\n"],"sourceRoot":""}